name: Build CMake preset
description: Build CMake preset

inputs:
  preset:
    description: CMake preset to build
    required: true

  cmake-extra-args:
    description: Extra arguments to pass to CMake
    required: false

  artifact-bindir:
    description: Path to the binary output directory (relative to build directory)
    required: false
    default: bin

outputs:
  build-artifact-name:
    description: Name of the uploaded build artifact
    value: ${{ steps.set-output.outputs.build-artifact-name }}

runs:
  using: composite
  steps:
    - name: Build CMake preset
      shell: bash
      run: |
        mkdir build
        cd build
        cmake .. --preset ${{ inputs.preset }} ${{ inputs.cmake-extra-args }}
        make -j$(nproc)

    - name: Set build artifact name
      id: set-output
      shell: bash
      run: echo "build-artifact-name=build-${{ inputs.preset }}" >> $GITHUB_OUTPUT

    - uses: actions/upload-artifact@v6
      with:
        name: ${{ steps.set-output.outputs.build-artifact-name }}
        path: build/${{ inputs.artifact-bindir }}
